@{
    Layout = null;
}
<!DOCTYPE html>

<html>
    <head>
        <title>Prova de Desenvolvimento</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <link href="~/Content/Site.css" rel="stylesheet" />   
        <style>
            .validation-error{
                color: red;
                font-size: medium;
            }
        </style> 
    </head>
    <body>
        <div class="container mt-lg-5">
            <h2>Cadastro de Usuários</h2>
            <form id="cadastroForm">
                <div class="mb-3">
                    <label for="FirstName" class="form-label">Nome</label>
                    <input id="FirstName" type="text" class="form-control" name="FirstName" value="">
                    <div id="FirstNameError" class="validation-error"></div>
                </div>
                <div class="mb-3">
                    <label for="LastName" class="form-label">Sobrenome</label>
                    <input id="LastName" type="text" class="form-control" name="LastName" value="" />
                    <div id="LastNameError" class="validation-error"></div>
                </div>
                <div class="mb-3">
                    <label for="Email" class="form-label">Email</label>
                    <input id="Email" type="email" class="form-control" name="Email" value="" />
                    <div id="EmailError" class="validation-error"></div>
                </div>
                <div class="mb-3">
                    <label for="BirthDate" class="form-label">Data de Nascimento</label>
                    <input id="BirthDate" type="date" class="form-control" name="BirthDate" value="" />
                    <div id="BirthDateError" class="validation-error"></div>
                </div>
                <div class="mb-3">
                    <label for="Password" class="form-label">Senha</label>
                    <input id="Password" type="password" class="form-control" name="Password" value="" />
                    <div id="PasswordError" class="validation-error"></div>
                </div>
                <div class="mb-3">
                    <label for="ConfirmPassword" class="form-label">Confirmação de Senha</label>
                    <input id="ConfirmPassword" type="password" class="form-control" name="ConfirmPassword" value="" />
                    <div id="ConfirmPasswordError" class="validation-error"></div>
                </div>

                <button id="btnSalvar" type="button" class="btn btn-primary">Salvar</button>
            </form>
            <div id="mensagemGeral" class="mt-3"></div>
        </div>

        <script src="~/Scripts/jquery-3.7.1.min.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
        
        <script>
            jQuery(document).ready(function () {

                function limparErros() {
                    jQuery(".validation-error").text("");
                    jQuery("#mensagemGeral").removeClass("alert alert-success alert-danger").text("");
                }

                // Inserir usuário
                //Salva as informções do usuário em uma variável
                jQuery('#btnSalvar').click(function () {
                    limparErros();
                    var userData = {
                        Id: (Math.floor((Math.random() * 1000) + 1)).toString(),
                        FirstName: jQuery("#FirstName").val().trim(),
                        LastName: jQuery("#LastName").val().trim(),
                        Email: jQuery("#Email").val().trim(),
                        BirthDate: jQuery("#BirthDate").val().trim(),
                        Password: jQuery("#Password").val().trim(),
                        ConfirmPassword: jQuery("#ConfirmPassword").val().trim()
                    };

                    jQuery.ajax({
                        url: '/UserViewModels/Create',
                        type: 'POST',
                        data: userData,

                        success: function (result) {
                            if (result.status === "ok") {
                                jQuery("#mensagemGeral").addClass("alert alert-success").text("Usuário cadastrado com sucesso! ID: " + result.usuario.Id);
                                jQuery("#cadastroForm")[0].reset();
                            } else if (result.status === "error") {
                                var erros = result.errors;
                                var errosParaAlert = [];

                                for (var fieldName in erros) {
                                    if (erros.hasOwnProperty(fieldName)) {
                                        var errorMessage = erros[fieldName][0].ErrorMessage;

                                        jQuery("#" + fieldName + "Error").text(errorMessage);

                                        errosParaAlert.push(errorMessage);
                                    }
                                }

                                jQuery("#mensagemGeral").addClass("alert alert-danger").text("Erro de Validação. Corrija os campos abaixo.");
                                console.error("Erros de validação detalhados:", erros);
                            } else {
                                jQuery("#mensagemGeral").addClass("alert alert-danger").text("Resposta inesperada do servidor.");
                            }
                        },

                        error: function (xhr, status, error) {
                            jQuery("#mensagemGeral").addClass("alert alert-danger").text("Erro de comunicação com o servidor: " + error);
                        }

                    });

                });

                // Listar usuários
                jQuery.ajax({
                    url: '/UserViewModels/List',
                    type: 'GET',
                    success: function (result) {
                        console.info(JSON.stringify(result));
                    },
                    error: function () {
                    }
                });

            });

        </script>
    </body>
</html>

